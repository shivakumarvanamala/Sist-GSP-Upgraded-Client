"use strict";(this.webpackChunk_hz_project_x=this.webpackChunk_hz_project_x||[]).push([[23553],{969115:(e,t,r)=>{r.d(t,{q:()=>i});const i={lrsEndpoint:new(r(988543).NE)("lrsEndpoint")}},983415:(e,t,r)=>{r.d(t,{q:()=>i});const i={isClipboardPasteListenerDisabled:new(r(370371).L0)("clipboard-paste-listener-disabled",!1)}},835179:(e,t,r)=>{var i;r.d(t,{h:()=>i}),function(e){e.addNewHzWorker="addNewHzWorker",e.removeHzWorker="removeHzWorker"}(i||(i={}))},416048:(e,t,r)=>{r.d(t,{N:()=>i});var i=(e=>(e.rendererHzWorkerInitCommunication="rendererHzWorkerInitCommunication",e))(i||{})},61658:(e,t,r)=>{r.d(t,{hr:()=>i,is:()=>o});const i=e=>{if(e.length>32)return console.warn("Too many metadata values"),!1;for(const[t,r]of e)if(!o(t,r))return!1;return!0},o=(e,t)=>/^[a-zA-Z][-.0-9a-zA-Z]+$/.test(e)?"string"!=typeof t&&"number"!=typeof t?(console.warn("Metadata value is badly typed"),!1):!("string"==typeof t&&t.length>1024)||(console.warn("Metadata value is too large"),!1):(console.warn("Metadata name is badly formatted"),!1)},299759:(e,t,r)=>{var i;r.d(t,{T:()=>i}),function(e){e[e.beginAction=1]="beginAction",e[e.endAction=2]="endAction",e[e.setActionMetadata=3]="setActionMetadata",e[e.beginFrame=4]="beginFrame",e[e.endFrame=5]="endFrame",e[e.setGlobalActionMetadataEntry=6]="setGlobalActionMetadataEntry"}(i||(i={}))},820165:(e,t,r)=>{r.d(t,{s:()=>i});class i{constructor(e,t,r){this._currentTimeFn=e??this._createDefaultCurrentTimeFunction(),this._timeOrigin=void 0!==t?t:performance.timeOrigin??performance.timing.navigationStart,this._currentDateFn=r??this._createDefaultCurrentDateFunction()}_createDefaultCurrentTimeFunction(){return void 0!==performance.timeOrigin?()=>performance.timeOrigin+performance.now():()=>Date.now()}_createDefaultCurrentDateFunction(){return()=>Date.now()}get timeOrigin(){return this._timeOrigin}currentTime(){return this._currentTimeFn()}currentTimeOffset(){return this._currentDateFn()-this.currentTime()}}},281097:(e,t,r)=>{r.d(t,{K:()=>i,a:()=>a});var i,o=r(299759),n=r(820165),s=r(61658);!function(e){e.rendered="rendered"}(i||(i={}));class a extends n.s{constructor(e,t,r){super(e,t,r)}beginAction(e,t,r,i,o){const n=i??this.currentTime(),s={recordsFrames:o?.recordsFrames??!0,locked:o?.locked??!1,startTimeOffset:this.currentTimeOffset(),marked:o?.marked??!1,markStartTime:o?.markStartTime,originAction:o?.originAction??!1};this._beginAction(e,t,r,n,s)}endAction(e,t){const r=t?.endTime??this.currentTime(),i={noError:t?.noError??!1,endTime:r,endTimeOffset:this.currentTimeOffset(),measureUntil:t?.measureUntil,cleanupECSId:t?.cleanupECSId};this._endAction(e,i)}setGlobalActionMetadataEntry(e,t){(void 0===t||(0,s.is)(e,t))&&this._setGlobalActionMetadataEntry(e,t)}setActionMetadata(e,t){if(void 0===t)return void this._setActionMetadata(e);const r=Object.entries(t);if(0===r.length)return void this._setActionMetadata(e);if(!(0,s.hr)(r))return;const i=Object.assign({},t);this._setActionMetadata(e,i)}beginFrame(e,t){this._beginFrame(e,t??this.currentTime())}endFrame(e,t){this._endFrame(e,t??this.currentTime())}applyChanges(e){e.forEach((e=>{this.applyChange(e)}))}applyChange(e){switch(e.type){case o.T.beginFrame:this._beginFrame(e.name,e.startTime);break;case o.T.endFrame:this._endFrame(e.name,e.endTime);break;case o.T.beginAction:this._beginAction(e.category,e.name,e.id,e.startTime,e.options);break;case o.T.endAction:this._endAction(e.id,e.options);break;case o.T.setActionMetadata:this._setActionMetadata(e.id,e.data);break;case o.T.setGlobalActionMetadataEntry:this._setGlobalActionMetadataEntry(e.name,e.value);break;default:console.error("Invalid perf change type.")}}beginStartupAction(e,t,r,i,o){this.beginAction("startup",e,e,t,{locked:!0,recordsFrames:!1,marked:r??!0,markStartTime:i,originAction:o})}endStartupAction(e,t){this.endAction(e,t)}beginOriginStartupAction(e){const t=this.timeOrigin;this.beginStartupAction(e,t,!0,0,!0)}markOriginStartupAction(e){this.beginOriginStartupAction(e),this.endStartupAction(e)}registerCompletedAction(e,t,r,i,o,n){const s=o-i;this.beginAction(e,t,r,s),n&&this.setActionMetadata(r,n),this.endAction(r,{endTime:o})}}},6815:(e,t,r)=>{r.d(t,{Xe:()=>n,Y2:()=>o,b7:()=>i});const i={apiKey:"required",serviceName:"required",snowId:"required",openTelemetryTracesEndpoint:"optional",openTelemetryMetricsEndpoint:"optional",openTelemetryConfiguration:"required",openTelemetryExportIntervalMillis:"optional",openTelemetryTemporalityPreference:"optional",openTelemetryMetricViews:"optional",openTelemetryBatchSize:"optional",openTelemetryQueueSize:"optional"};function o(e,t,r){s(e,r?r.url:t.url)}function n(e,t){s(e,t.responseURL)}function s(e,t){const r=new URL(t);e?.updateName(r.protocol.split(":")[0].toUpperCase()+" "+e.attributes["http.method"]+" "+r.hostname)}},835244:(e,t,r)=>{var i;r.d(t,{S:()=>i}),function(e){e.changeLocale="changeLocale"}(i||(i={}))},351931:(e,t,r)=>{r.d(t,{Fg:()=>d,Kq:()=>c,Mu:()=>a});var i=r(624451),o=r(797131),n=r(863326),s=r(537308);function a(e){const t=e.progressMessagePrefix||"";return{maxAttempts:e.maxAttempts||n.X5,shouldRetry:c.bind(null,e,n.LU.standardRetryableClause),affectDelayHook:d.bind(null,void 0),progressMessagePrefix:t,progressCallback:(t,r,i)=>{if(i){let n,a;i instanceof s.AdobeDCXError&&(n=i.response?.xhr?.body,n&&n instanceof ArrayBuffer&&(n=(0,o.arrayBufferToString)(n)),a=i.response?.headers?.["x-request-id"]);let c=i;n&&(c=Object.assign({},c,{response:{xhr:{body:n}}})),a&&(c=Object.assign({},c,{headers:{"x-request-id":a}})),e.logger.warn(t,r,c)}else e.logger.info(t,r)}}}const c=(e,t,r,i)=>{let o=!1;const a=n.LU.getAdobeDCXError(r);if(a)if(0===a.response?.statusCode||a.code===s.DCXError.NETWORK_ERROR)o=!0;else if(t(a)){const t=n.LU.getRetryAfterInMsFromDCXError(a);o=t?((e,t,r)=>t+(r||0)<=(e.circuitBreakerTimeout||t))(e,t,i):e.shouldAlwaysRetryOnServerError??!1}return o},d=(e,t)=>{const r=n.LU.getAdobeDCXError(t),o=n.LU.getRetryAfterInMsFromDCXError(r);return o?{type:i.Z.MINIMUM,value:o}:e}},541428:(e,t,r)=>{r.d(t,{x:()=>n});var i=r(191332),o=r(790176);class n{constructor(){this._metadataLinks=new Map,this._indexLinks=new Map,this._linksPopulatedDeferred=new o.B}cacheLinksFromResponse(e){const t=e.docSpec[i.Properties.REPO_ASSET_ID];if(!t)throw new Error("Unable to cache links from server response payload: No docId found.");const r=n._normalizeKey(t);e.indexLinks&&this._indexLinks.set(r,e.indexLinks),e.metadataLinks&&this._metadataLinks.set(r,e.metadataLinks),this._linksPopulatedDeferred.resolve()}async getMetadataLinks(e){await this._linksPopulatedDeferred.promise;const t=n._normalizeKey(e);return this._metadataLinks.get(t)}async getIndexLinks(e){await this._linksPopulatedDeferred.promise;const t=n._normalizeKey(e);return this._indexLinks.get(t)}clear(){this._metadataLinks.clear(),this._indexLinks.clear()}static _normalizeKey(e){return e.toLowerCase()}}},675376:(e,t,r)=>{r.d(t,{HN:()=>s,I8:()=>o,hJ:()=>n});var i=r(537308);const o=new Map([[i.ProblemTypes.DCX_VALIDATION,"DcxValidation"],[i.ProblemTypes.RESPONSE_TOO_LARGE,"ResponseTooLarge"],[i.ProblemTypes.QUOTA_EXCEEDED,"NoStorageQuota"],[i.ProblemTypes.BULK_REQUEST_NOT_ATTEMPTED,"BulkRequestNotAttempted"],["http://ns.adobe.com/adobecloud/problem/badrequest","BadRequest"],["http://ns.adobe.com/adobecloud/problem/assetnamenotvalid","AssetNameNotValid"],["http://ns.adobe.com/adobecloud/problem/directorynotempty","DirectoryNotEmpty"],["http://ns.adobe.com/adobecloud/problem/invalidfragment","InvalidFragment"],["http://ns.adobe.com/adobecloud/problem/embedtoolarge","EmbedTooLarge"],["http://ns.adobe.com/adobecloud/problem/embedinvalid","EmbedInvalid"],["http://ns.adobe.com/adobecloud/problem/limit/resourcesize","ResourceSizeLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/limit/pathsegmentcount","PathSegmentCountLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/limit/namelength","NameLengthLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/limit/milestonelabellength","MilestoneLabelLengthLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/limit/milestonedescriptionlength","MilestoneDescriptionLengthLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/limit/resourcecount","ResourceCountLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/limit/embedspecifierselectorcount","EmbedSpecifierSelectorCountLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/encryptionkeyinaccessible","EncryptionKeyInaccessible"],["http://ns.adobe.com/adobecloud/problem/accessdenied","AccessDenied"],["http://ns.adobe.com/adobecloud/problem/resourceblocked","ResourceBlocked"],["http://ns.adobe.com/adobecloud/problem/userblocked","UserBlocked"],["http://ns.adobe.com/adobecloud/problem/assetstatenotallowed","AssetStateNotAllowed"],["http://ns.adobe.com/adobecloud/problem/limit/milestonecount","MilestoneCountLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/limit/childrencount","ChildrenCountLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/limit/componentcount","ComponentCountLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/resourcenotready","ResourceNotReady"],["http://ns.adobe.com/adobecloud/problem/repositorynotfound","RepositoryNotFound"],["http://ns.adobe.com/adobecloud/problem/assetnotfound","AssetNotFound"],["http://ns.adobe.com/adobecloud/problem/versionnotfound","VersionNotFound"],["http://ns.adobe.com/adobecloud/problem/resourcenotfound","ResourceNotFound"],["http://ns.adobe.com/adobecloud/problem/assetnameconflict","AssetNameConflict"],["http://ns.adobe.com/adobecloud/problem/operation/targetconflict","TargetConflict"],["http://ns.adobe.com/adobecloud/problem/limit/operationcount","OperationCountLimitExceeded"],["http://ns.adobe.com/adobecloud/problem/resourcenotallowed","ResourceNotAllowed"],["http://ns.adobe.com/adobecloud/problem/assetlocked","AssetLocked"],["http://ns.adobe.com/adobecloud/problem/operationfailed","OperationFailed"],["http://ns.adobe.com/adobecloud/problem/notentitled","UserNotEntitled"]]);function n(e,t){if(e[t])return Array.isArray(e[t])?e[t][0]:e[t]}function s(e,t){const r=n(e,t);return r?r.href:""}},863869:(e,t,r)=>{var i,o,n,s,a,c,d,l,h,u;r.d(t,{JP:()=>h,bX:()=>i,by:()=>o,oI:()=>d,r4:()=>m,x6:()=>c,zU:()=>u,zt:()=>n}),function(e){e.Create="http://ns.adobe.com/horizon/rel/create",e.GetDocument="http://ns.adobe.com/horizon/rel/document",e.GetDocumentMetadata="http://ns.adobe.com/horizon/rel/document/metadata",e.GetDocumentWithRepositoryId="http://ns.adobe.com/horizon/rel/repository/document",e.GetDocumentMetadataWithRepositoryId="http://ns.adobe.com/horizon/rel/repository/document/metadata",e.Asset="http://ns.adobe.com/horizon/rel/component-upload"}(i||(i={})),function(e){e.US="US",e.EU="EU",e.AP="AP"}(o||(o={})),function(e){e.createBlank="createBlank",e.createFromDocModel="createFromDocModel",e.createFromTemplate="createFromTemplate",e.createCopyFromOtherDocument="createCopyFromOtherDocument",e.createFromAssets="createFromAssets",e.createFromCompositeAndDocModel="createFromCompositeAndDocModel"}(n||(n={})),function(e){e.openDocument="openDocument",e.openDocumentGuest="openDocumentGuest"}(s||(s={})),function(e){e.uploadAssets="uploadAssets",e.assetImportStatus="assetImportStatus"}(a||(a={})),function(e){e.metadata="metadata",e.none="none"}(c||(c={})),function(e){e.PSDC="PSDC",e.AIC="AIC",e.XDC="XDC",e.imageURI="imageURI",e.movieURI="movieURI",e.AdobeStock="AdobeStock",e.Pixabay="Pixabay",e.GooglePhotos="GooglePhotos",e.NounProject="NounProject",e.Lightroom="Lightroom",e.Bing="Bing",e.clientImage="clientImage",e.rendition="rendition",e.clientVideo="clientVideo",e.clientAudio="clientAudio",e.clientImageSequence="clientImageSequence",e.webLink="webLink",e.libraryImageElement="libraryImageElement",e.sparkResourceMigration="sparkResourceMigration",e.caiMedia="caiMedia"}(d||(d={})),function(e){e.head="head",e.nonHead="nonHead"}(l||(l={})),function(e){e.Thumbnail="thumbnail",e.Preview="preview",e.Full="full"}(h||(h={})),function(e){e.thumbnailImage="pageThumbnailImage",e.thumbnailVideo="pageThumbnailVideo",e.previewImage="pagePreviewImage",e.previewVideo="pagePreviewVideo"}(u||(u={}));const m={"image/png":"png","image/jpeg":"jpeg","image/webp":"webp"};var g;!function(e){e.successful="successful",e.failed="failed"}(g||(g={}))},535606:(e,t,r)=>{r.d(t,{M:()=>o,a:()=>n});var i=r(378336);const o={[i.e8.fred]:".canvas",[i.e8.projectx]:".express",[i.e8.squirrel]:".squirrel",[i.e8.webpagetemp]:".webpage"},n="horizon-hero-thumbnail"},867757:(e,t,r)=>{r.d(t,{J0:()=>d,iZ:()=>s});var i=r(863326),o=r(253624),n=r(647435);const s="LRSUtils";var a;!function(e){e.LRSAPIDiscoveryLinkEmptyURL="LRSAPIDiscoveryLinkEmptyURL",e.LRSAPIDiscoveryLookUpFailed="LRSAPIDiscoveryLookUpFailed",e.LRSAPIDiscoveryLookUpInvalid="LRSAPIDiscoveryLookUpInvalid",e.LRSAPIResolveLinkInfoMissing="LRSAPIResolveLinkInfoMissing",e.LRSAPIFetchTargetMissing="LRSAPIFetchTargetMissing",e.LRSAPIReturnsError="LRSAPIReturnsError"}(a||(a={}));const c={LRSAPIDiscoveryLinkEmptyURL:"Discovery Link is empty",LRSAPIDiscoveryLookUpFailed:"Failed to fetch the discovery api",LRSAPIDiscoveryLookUpInvalid:"Discovery API returns empty result",LRSAPIResolveLinkInfoMissing:"No data present for the given fetch key",LRSAPIFetchTargetMissing:"Invalid response from LRS resolve api",LRSAPIReturnsError:"LRS API resolve returns error"};class d{static getHzErrorFromErrorCode(e,t){return new o.R(e,c[e],d._getHzErrorOptions(t))}static async checkFetchStatus(e,t){if(!e.ok){let r;try{r=await e.json()}catch{}throw n.o.fromResponse(e,t,void 0,d._getHzErrorOptions(i.LU.getLogInfoFromFetchResponse(e,r)))}}static _getHzErrorOptions(e){return{category:s,logMetadata:{...e,package:"lrs-utils"}}}}},851285:(e,t,r)=>{r.d(t,{g7:()=>h});var i=r(863326),o=r(647435),n=r(610656),s=r(789254),a=r(838840),c=r(867757),d=r(790176);const l="http://ns.adobe.com/lrs/rel/resolve";class h{constructor(e,t,r,i,o=s.Yd.singleton().get("lrs-utils"),n){this._discoveryURL=e,this._host=t,this._apiKey=r,this._sessionId=i,this._logger=o,this._agent=n,this._lastDiscoveryTime=0}_getCommonFetchWithRetryOptions(){return{host:this._host,logger:this._logger,finalErrorCategory:c.iZ}}_getLinks(e){return(!this._discoveryLinksDeferred||Date.now()-this._lastDiscoveryTime>864e4)&&(this._discoveryLinksDeferred?this._discoveryLinksDeferred.reset():this._discoveryLinksDeferred=new d.B,this._discoveryLinksDeferred.adopt(this._getDiscoveryLinks(e)).then((e=>(this._lastDiscoveryTime=Date.now(),e))).catch((()=>{this._logger.traceflow("LRSUtils","LRS Discovery failed")}))),this._discoveryLinksDeferred.promise}_getRequestHeaders(e){return{"x-api-key":this._apiKey,"x-request-id":e||this._sessionId}}async _getDiscoveryLinks(e){if(!this._discoveryURL||0===this._discoveryURL.length)throw c.J0.getHzErrorFromErrorCode("LRSAPIDiscoveryLinkEmptyURL");const t={method:"GET",headers:this._getRequestHeaders(e),agent:this._agent},r=await(0,a.q)({...this._getCommonFetchWithRetryOptions(),url:this._discoveryURL,fetchRequestOptions:t,returnFinalResponse:!0});await c.J0.checkFetchStatus(r);const o=await r.json();if(!o._links)throw c.J0.getHzErrorFromErrorCode("LRSAPIDiscoveryLookUpInvalid",i.LU.getLogInfoFromFetchResponse(r));return o._links}async getLinkStatus(e,t){const r={id:e},s={"repo:assetId":"","repo:repositoryId":""};try{const e=await this._getLinks(t);if(!e[l]||!e[l].href)throw c.J0.getHzErrorFromErrorCode("LRSAPIResolveLinkInfoMissing");const d=new n.Z(e[l].href).expand(r),h={method:"GET",headers:this._getRequestHeaders(t),agent:this._agent},u=await(0,a.q)({...this._getCommonFetchWithRetryOptions(),url:d,fetchRequestOptions:h,returnFinalResponse:!0});if(404===u.status)return s;if(i.LU.isErrorStatus(u.status)){const e=i.LU.getLogInfoFromFetchResponse(u),t=c.J0._getHzErrorOptions(e);throw o.o.fromResponse(u,"LRSAPIReturnsError",u.statusText,t)}try{const e=(await u.json()).target;return{"repo:assetId":e.id,"repo:repositoryId":e.repositoryId}}catch(e){throw c.J0.getHzErrorFromErrorCode("LRSAPIFetchTargetMissing")}}catch(e){return this._logger.error("LRSUtils.getLinkStatus:",e),s}}}},369347:(e,t,r)=>{r.d(t,{Rr:()=>n});var i=r(969115),o=r(851285);async function n(e,t,r){const n=await e.get("AppConfig");return await n.attach(i.q),new o.g7(i.q.lrsEndpoint.value,t,r,n.sessionId)}},431947:(e,t,r)=>{r.d(t,{a:()=>o});var i=r(790176);class o{constructor(e,t){this._perfMonitor=e,this._actionName=t,this._deferred=new i.B,this._isLoading=!1}get result(){return this._deferred.promise}reset(){this._deferred.reset()}async load(){return this._markLoadBegin(),this._deferred.adoptOnce((async()=>{try{const e=await this.executeLoad();return this._markLoadEnd(),e}catch(e){throw this._markLoadEnd(),e}}))}get isLoading(){return this._isLoading}async setPerfMonitor(e){this.isLoading&&await this.result,this._perfMonitor=e}_markLoadBegin(){this._isLoading=!0,this._perfMonitor&&this._actionName&&this._perfMonitor.beginStartupAction(this._actionName)}_markLoadEnd(){this._isLoading=!1,this._perfMonitor&&this._actionName&&this._perfMonitor.endStartupAction(this._actionName)}}},709640:(e,t,r)=>{r.d(t,{_:()=>i});const i={minBufferLength:1024,bufferReallocGrowthFactor:2,maintenanceIntervalMilliseconds:6e4}},341299:(e,t,r)=>{var i;r.d(t,{z:()=>i}),function(e){e.rendererStart="rendererStartInitRequest"}(i||(i={}))},246060:(e,t,r)=>{var i;r.d(t,{n:()=>i}),function(e){e.rendererStart="rendererStartInitResult"}(i||(i={}))},26505:(e,t,r)=>{var i;r.d(t,{b:()=>i}),function(e){e.rendererShutdown="rendererShutdownNotification"}(i||(i={}))},587171:(e,t,r)=>{var i;r.d(t,{X:()=>i}),function(e){e.rendererShutdown="rendererShutdownRequest"}(i||(i={}))},616794:(e,t,r)=>{r.d(t,{e:()=>s});var i=r(983415);class o{constructor(){this._enablementChecks=[]}get pasteEnabled(){return!i.q.isClipboardPasteListenerDisabled.enabled&&(!this._enablementChecks.some((e=>e.isPasteDisabled&&e.isPasteDisabled()))&&this._enablementChecks.some((e=>e.isActivePasteTarget&&e.isActivePasteTarget())))}addClipboardEnablementCheck(e){this._enablementChecks.push(e)}get copyEnabled(){return this._enablementChecks.some((e=>e.isActiveCopyTarget&&e.isActiveCopyTarget()))}}async function n(){return new o}function s(e){e.set("ClipboardStore",n)}},5538:(e,t,r)=>{r.d(t,{Zy:()=>w,dP:()=>R,vt:()=>F,Cq:()=>b,gD:()=>A});var i=r(541428),o=r(685493),n=r(369347);const s={perfMonitorMarkAllActions:new(r(370371).L0)("perf-monitor-mark-all-actions",!1)};class a{constructor(e){this._trailingFramesCapacity=e,this._trailingFrames=[],this._trailingFramesAvgDuration=0,this._trailingFramesMinDuration=1/0,this._trailingFramesMaxDuration=-1/0,this._needsRecomputeTrailingFramesMinMaxDuration=!0,this._allFramesCount=0,this._allFramesAvgDuration=0,this._allFramesMinDuration=1/0,this._allFramesMaxDuration=-1/0}push(e){if(e.hasEnded)if(this._trailingFrames.push(e),this._allFramesCount++,this._allFramesMinDuration=Math.min(e.duration,this._allFramesMinDuration),this._allFramesMaxDuration=Math.max(this._allFramesMaxDuration,e.duration),this._allFramesAvgDuration=this._allFramesAvgDuration+(e.duration-this._allFramesAvgDuration)/this._allFramesCount,this._trailingFrames.length<=this._trailingFramesCapacity)this._trailingFramesAvgDuration=this._allFramesAvgDuration,this._trailingFramesMinDuration=this._allFramesMinDuration,this._trailingFramesMaxDuration=this._allFramesMaxDuration,this._needsRecomputeTrailingFramesMinMaxDuration=!1;else{const t=this._trailingFrames.shift();this._trailingFramesAvgDuration=this._trailingFramesAvgDuration+(e.duration-t.duration)/this._trailingFramesCapacity,this._needsRecomputeTrailingFramesMinMaxDuration=!0}else console.warn("Complete frame required.")}get trailingFramesCapacity(){return this._trailingFramesCapacity}get trailingFramesCount(){return this._trailingFrames.length}get trailingFrames(){return this._trailingFrames}get trailingAvgDuration(){return this._trailingFramesAvgDuration}get trailingMinDuration(){return this._recomputeTrailingFramesMinMaxDurationIfNeeded(),this._trailingFramesMinDuration}get trailingMaxDuration(){return this._recomputeTrailingFramesMinMaxDurationIfNeeded(),this._trailingFramesMaxDuration}_recomputeTrailingFramesMinMaxDurationIfNeeded(){if(!1!==this._needsRecomputeTrailingFramesMinMaxDuration){this._trailingFramesMinDuration=1/0,this._trailingFramesMaxDuration=-1/0;for(const e of this._trailingFrames){const t=e.duration;t<this._trailingFramesMinDuration&&(this._trailingFramesMinDuration=t),this._trailingFramesMaxDuration<t&&(this._trailingFramesMaxDuration=t)}Number.isFinite(this._trailingFramesMinDuration)||(this._trailingFramesMinDuration=0),Number.isFinite(this._trailingFramesMaxDuration)||(this._trailingFramesMaxDuration=0),this._needsRecomputeTrailingFramesMinMaxDuration=!1}}get framesCount(){return this._allFramesCount}get avgDuration(){return this._allFramesAvgDuration}get minDuration(){return Number.isFinite(this._allFramesMinDuration)?this._allFramesMinDuration:0}get maxDuration(){return Number.isFinite(this._allFramesMaxDuration)?this._trailingFramesMaxDuration:0}}class c{constructor(e,t,r,i,o,n,s,a,c,d){this._category=e,this._name=t,this._id=r,this._startTime=i,this._startTimeOffset=o,this._recordsFrames=n,this._locked=s,this._marked=a,this._frameCapacity=c,this._hasBeenHidden=d,this._endTime=-1,this._framesByName=new Map,this._metadata=void 0,this._endTimeOffset=0}static createForTrailingFrames(e){return new c("","","",-1,0,!0,!1,!1,e,!1)}get hasEnded(){return this._endTime>0}get hasBeenHidden(){return this._hasBeenHidden}set hasBeenHidden(e){this._hasBeenHidden=e}get category(){return this._category}get name(){return this._name}get id(){return this._id}get startTime(){return this._startTime}get endTime(){return this._endTime}get startTimeOffset(){return this._startTimeOffset}get endTimeOffset(){return this._endTimeOffset}set endTimeOffset(e){this._endTimeOffset=e}get recordsFrames(){return this._recordsFrames}get locked(){return this._locked}get marked(){return this._marked}get frameCapacity(){return this._frameCapacity}get duration(){return this.hasEnded?this._endTime-this._startTime:-1}get metadata(){return this._metadata}set metadata(e){this._metadata=e}getFramesByName(e){return this._framesByName.get(e)}getNumFramesByName(e){return this.getFramesByName(e)?.framesCount??0}end(e){e<this._startTime?(console.warn(`PerfAction.end: endTime should be greater than or equal to startTime for action with name "${this.name}" and id "${this.id}".`),this._endTime=this._startTime):this._endTime=e}isFrameInRange(e){return e.startTime>=this._startTime&&(-1===this._endTime||e.endTime<=this._endTime)}pushFrame(e,t){if(!this._recordsFrames)return;let r=this.getFramesByName(e);r||(r=new a(this._frameCapacity),this._framesByName.set(e,r)),r.push(t)}}class d{constructor(e){this._startTime=e,this._endTime=-1}end(e){e<this._startTime?(console.warn("PerfFrame.end: endTime should be greater than or equal to startTime."),this._endTime=this._startTime):this._endTime=e}get hasEnded(){return this._endTime>0}get startTime(){return this._startTime}get endTime(){return this._endTime}get duration(){return this.hasEnded?this._endTime-this._startTime:-1}}var l=r(281097);class h extends l.a{constructor(e){super(e.currentTimeFn,e.timeOrigin,e.currentDateFn),this._completedActions=[],this._openActionsByID=new Map,this._openFramesByName=new Map,this._hasVisibilityEverBeenHidden="hidden"===document.visibilityState,this._globalActionMetadata={},this._isMonitoringActions=!1,this._maxActions=e.maxActions,this._trailingFramesAction=c.createForTrailingFrames(e.numTrailingFramesToTrack),this._markAllActions=e.markAllActions}get trailingFramesAction(){return this._trailingFramesAction}get completedActions(){return this._completedActions}startMonitoringActions(e){this._isMonitoringActions||(this._isMonitoringActions=!0,this._actionCompleteCallback=e,this.startVisibilityEventListener(),this._completedActions.forEach((t=>e(t))))}stopMonitoringActions(){this._isMonitoringActions&&(this.stopVisibilityEventListener(),this._actionCompleteCallback=void 0,this._isMonitoringActions=!1)}_onActionCompleted(e){let t=!0;this._completedActions.length>=this._maxActions&&(this._removeOldestAction()||(t=!1)),t&&this._completedActions.push(e),this._isMonitoringActions&&void 0!==this._actionCompleteCallback&&this._actionCompleteCallback(e)}_onVisibilityChange(){if("hidden"===document.visibilityState){this._hasVisibilityEverBeenHidden=!0;[...this._openActionsByID.values()].forEach((e=>{e.hasBeenHidden=!0}))}}registerCompletedAction(e,t,r,i,o,n){const s=o??this.currentTime();super.registerCompletedAction(e,t,r,i,s,n)}startVisibilityEventListener(){document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))}stopVisibilityEventListener(){document.removeEventListener("visibilitychange",this._onVisibilityChange.bind(this))}_beginAction(e,t,r,i,o){if(this._openActionsByID.has(r))return;const n=!!o.originAction&&this._hasVisibilityEverBeenHidden,s=new c(e,t,r,i,o.startTimeOffset??0,o.recordsFrames,o.locked,o.marked,h.DEFAULT_MAX_FRAMES_PER_ACTION,n);this._openActionsByID.set(r,s);(this._markAllActions||o.marked)&&this._beginMark(s,o.markStartTime)}_endAction(e,t){const r=this._openActionsByID.get(e);if(!r){if(t.noError)return;return void console.error(`Action not found with id: ${e}`)}const i=this._markAllActions||r.marked;if(r.end(t.endTime),r.endTimeOffset=t.endTimeOffset??0,i&&this._endMark(r),Object.keys(this._globalActionMetadata).length>0){const e=Object.assign({},this._globalActionMetadata,r.metadata);r.metadata=e}this._openActionsByID.delete(r.id),this._onActionCompleted(r)}_setActionMetadata(e,t){const r=this._openActionsByID.get(e);r?r.metadata=t:console.warn(`Action not found with id: ${e}`)}_setGlobalActionMetadataEntry(e,t){Object.keys(this._globalActionMetadata).length>=8?console.warn("Too many global metadata values"):void 0!==t?this._globalActionMetadata[e]=t:delete this._globalActionMetadata[e]}_beginFrame(e,t){if(this._openFramesByName.has(e))return void console.error(`Frame has already begun with name: ${e}`);const r=new d(t);this._openFramesByName.set(e,r)}_endFrame(e,t){const r=this._openFramesByName.get(e);r?(r.end(t),this._openFramesByName.delete(e),this._pushFrameToOpenActions(e,r),this._trailingFramesAction.pushFrame(e,r)):console.error(`Frame not found with name: ${e}`)}_pushFrameToOpenActions(e,t){this._openActionsByID.forEach((r=>{r.isFrameInRange(t)&&r.pushFrame(e,t)}))}_removeOldestAction(){const e=this._completedActions.findIndex((e=>!e.locked));return!(e<0)&&(this._completedActions.splice(e,1),!0)}_beginMark(e,t){const r=void 0!==t?{startTime:t}:{startTime:e.startTime-this.timeOrigin};performance.mark(this._getMarkName(e.category,e.id,"begin"),r)}_endMark(e){const t={startTime:e.endTime-this.timeOrigin};performance.mark(this._getMarkName(e.category,e.id,"end"),t),performance.measure(this._getMarkName(e.category,e.id),this._getMarkName(e.category,e.id,"begin"),this._getMarkName(e.category,e.id,"end"))}_getMarkName(e,t,r){return r?`${e}:${t}:${r}`:`${e}:${t}`}}h.DEFAULT_MAX_FRAMES_PER_ACTION=1800;var u=r(741111),m=r(431947),g=r(605947),p=r(345258);class _ extends m.a{constructor(e,t,r,i,o,n,s){super(e,"preload-document"),this._routeInfoResult=t,this._imsService=r,this._invitationService=i,this._lrsUtilsResolver=o,this._documentServiceResolver=n,this._contentClientResolver=s}async executeLoad(){if(this._routeInfoResult.action!==p.k.documentId&&this._routeInfoResult.action!==p.k.new)return;const e=await this._imsService.getAccessTokenValue(),t=this._routeInfoResult.resourceId;return this._routeInfoResult.action===p.k.new?this._executeTemplateLoad(t,e):e?this._executeDocumentLoad(t):void 0}async _executeDocumentLoad(e){const t=await this._documentServiceResolver(),r=await t.openDocument(e),i={...r,accessStatus:u.AS.HAS_ACCESS};if(200!==r.httpStatus){const t=this._invitationService.getDocAccessStatus(e),o=g.q.moveFromPersonalStorageToSpace.enabled;let n=Promise.resolve();if(o&&404===r.httpStatus){n=(await this._lrsUtilsResolver()).getLinkStatus(e)}i.accessStatus=await t,i.accessStatus===u.AS.HAS_ACCESS&&i.error&&delete i.error;const s=await n;s?.["repo:assetId"]&&(i.accessStatus=u.AS.HAS_ACCESS,i.movedDocId=s["repo:assetId"])}return i}async _executeTemplateLoad(e,t){if(!e)return;const r=await this._contentClientResolver();r.accessToken=t;return{...await r.fetchTemplate(e,this._routeInfoResult.documentSpec),accessStatus:u.AS.HAS_ACCESS}}}var f=r(789254);class y{constructor(e,t,r,i,o,n,s,a,c,d){this.imsServiceResolver=e,this.invitationServiceResolver=t,this.accessCheckServiceResolver=r,this.routeInfoResultResolver=i,this.authoringWorkerLoaderResolver=o,this.rendererWorkerLoaderResolver=n,this.documentPreloaderResolver=s,this._docAccessStatusStoreResolver=a,this._udsClientResolver=c,this._appConfigResolver=d,this._udsPublicBetaAccessSectionName="hasPublicBetaAccess",this.startEditorFlowAfterOnLoad=async()=>{const e=()=>{this.startEditingFlow(),window.removeEventListener("load",e)};"complete"===document.readyState?e():window.addEventListener("load",e)}}async processDocumentOrTemplate(){const e=await this.routeInfoResultResolver();return e?.action===p.k.documentId&&e.resourceId?this.verifyDocumentAccess(e.resourceId):e?.action===p.k.new&&e.resourceId?this._triggerTemplatePreload():void 0}async startEditingFlow(){const[e,t]=await Promise.all([this.authoringWorkerLoaderResolver(),this.rendererWorkerLoaderResolver()]);return e.load(),t.load(),this.processDocumentOrTemplate()}async startPreloadingFlow(){(await this.authoringWorkerLoaderResolver()).load()}async _triggerTemplatePreload(){return(await this.documentPreloaderResolver()).load()}async resetDocumentPreloader(){(await this.documentPreloaderResolver()).reset()}async startUserFlow(){const e=await this.imsServiceResolver();await e.load(),await e.ensureSignedInUser(),e.getProfile(),this.checkUserAccessToApp()}async checkUserAccessToApp(){(await this.accessCheckServiceResolver()).checkAccess()}async _savePublicBetaHasAccessUdsData(e,t){try{await g.q.udsAppDomain.initialized();const r={appDomain:g.q.udsAppDomain.value},i=await this._udsClientResolver();await i.saveAppSectionData(r,e,t)}catch(e){f.Yd.warn("Error while fetching Public Beta Welcome Modal data from UDS: ",e)}}async isNotPublicBetaAudience(){const e=await this._appConfigResolver();if(!await e.hasFeature("public-beta-cutover"))return!1;const t=(await this.accessCheckServiceResolver()).betaAccessStrategy;if(t.verifyDocAccess())return!1;const{isAllowedForPublicBeta:r,isAllowedForPrivateBeta:i}=await(t.getPublicBetaFeatureFlagValues&&t.getPublicBetaFeatureFlagValues());return!r||!i}async verifyDocumentAccess(e){const t=(await this.documentPreloaderResolver()).load(),[r,i,o]=await Promise.all([this.imsServiceResolver(),this.invitationServiceResolver(),this._docAccessStatusStoreResolver()]);let n=u.AS.HAS_ACCESS;return t.then((async t=>{n=t?t.accessStatus:await i.getDocAccessStatus(e)})).catch((()=>{n=u.AS.UNKNOWN_ERROR})).finally((()=>{n!==u.AS.HAS_ACCESS&&r.isSignedInUser()&&o.setAccessStatus(n),n===u.AS.HAS_ACCESS&&this.isNotPublicBetaAudience().then((async e=>{e&&this._savePublicBetaHasAccessUdsData(this._udsPublicBetaAccessSectionName,!0)}))}))}}async function k(e){const[t,r]=await e.getAll(["PerfMonitorModelOptions","AppConfig"]);return await r.attach(s),t.markAllActions=s.perfMonitorMarkAllActions.enabled,new h(t)}function b(e,t={maxActions:50,numTrailingFramesToTrack:100}){e.set("PerfMonitorModelOptions",(async()=>t)),e.set("PerfMonitorModel",k)}async function v(e){const t=e.getResolver("AccessCheckService"),r=e.getResolver("BasicRouteInfoResult"),i=e.getResolver("ImsService"),o=e.getResolver("InvitationService"),n=e.getResolver("DocAccessStatusStore"),s=e.getResolver("UdsClient"),a=e.getResolver("AppConfig"),c=e.getResolver("AuthoringWorkerLoader"),d=e.getResolver("RendererWorkerLoader"),l=e.getResolver("DocumentPreloader");return new y(i,o,t,r,c,d,l,n,s,a)}function A(e){e.set("PreloaderService",v)}function w(e){e.set("DocumentLinksCache",(async()=>new i.x))}async function S(e){const[t,r,i,o,s,a]=await e.getAll(["PerfMonitorModel","BasicRouteInfoResult","ImsService","InvitationService","Host","StaticConfig"]);return e.set("LRSUtils",(async()=>(0,n.Rr)(e,s,a.adobeIoApiKey))),new _(t,r,i,o,e.getResolver("LRSUtils"),e.getResolver("DocumentService"),e.getResolver("ContentClient"))}function R(e){e.set("DocumentPreloader",S)}async function C(e){const[t,r,i,n,s,a]=await e.getAll(["Host","AppConfig","ImsService","DocumentServiceConfig","BasicRouteInfoResult","StaticConfig"]),c=await i.getAccessTokenValue();return o.EG.create(t,r.sessionId,(async()=>c||""),n,e.getResolver("DocumentLinksCache"),"stage"===a.env?s?.search?.get("dasRegionOverride")??void 0:void 0)}function F(e){e.set("DocumentService",C)}},505839:(e,t,r)=>{r.d(t,{l0:()=>N,z7:()=>G,Fe:()=>W,FU:()=>E,ic:()=>V,Q:()=>x,dS:()=>B,LI:()=>z});var i=r(446422);class o{constructor(){this._channelMap=new Map}setBackendSyncCallback(e){this._backendSyncMessageCallback=e,this._doSync()}getFrontendPort(e){if(!this._channelMap.has(e)){const t=new MessageChannel;this._channelMap.set(e,t),void 0!==this._backendSyncMessageCallback&&this._doSync()}return this._channelMap.get(e).port1}_doSync(){this._backendSyncMessageCallback(...this._createSyncMessage())}_createSyncMessage(){const e=[],t=[];this._channelMap.forEach(((r,i)=>{e.push(i),t.push(r.port2)}));return[{messageChannelKeys:e,messagePorts:t},t]}reset(){this._channelMap=new Map,this._backendSyncMessageCallback=void 0}}var n,s=r(379434);!function(e){e.initCoediting="initCoediting",e.initFontsRequest="initFontsRequest",e.initFontsResponse="initFontsResponse",e.startAuthoring="startAuthoring",e.startAuthoringCore="startAuthoringCore",e.authoringStarted="authoringStarted",e.updateAnalyticsContext="updateAnalyticsContext",e.updateAnalyticsClient="updateAnalyticsClient",e.syncMessageChannels="syncMessageChannels",e.requestPreloaderConfig="requestPreloaderConfig",e.requestPreloaderConfigResponse="requestPreloaderConfigResponse"}(n||(n={}));var a=r(431947),c=r(345258),d=r(605947);class l extends a.a{constructor(e,t,r,i,o,s,a){super(void 0,"load-authoring-worker"),this._loggerResolver=e,this._workerFactory=t,this._routeInfoResultResolver=r,this._imsServiceResolver=i,this._appConfigResolver=o,this._loaderConfigResolver=s,this._userStoreResolver=a,this._handleInitFontsOnWorker=async e=>{if(e.data.type===n.initFontsRequest){this._worker.removeEventListener("message",this._handleInitFontsOnWorker);const e=await this._imsServiceResolver();let t,r=!1;e?(e.isLoaded||await e.load(),t=await e.getAccessTokenValue()):r=!0;const[i,o]=await Promise.all([this._userStoreResolver(),this._loaderConfigResolver()]);await(i?.load());const s=i?i.userId:"";this._worker.postMessage({type:n.initFontsResponse,payload:{userId:s,apiKey:o.apiKey,authToken:t,lesEnvironment:o.lesEnv,localFonts:r}})}},this._handlePreloaderConfigRequest=async e=>{if(e.data.type===n.requestPreloaderConfig){let e;this._worker.removeEventListener("message",this._handlePreloaderConfigRequest);const t=await this._imsServiceResolver();t&&(e=await t.getAccessTokenValue());const[r]=await Promise.all([this._appConfigResolver()]),i={appConfigDataTransfer:await r.getWorkerDataTransfer(),imsToken:e};this._worker.postMessage({type:n.requestPreloaderConfigResponse,payload:i})}}}async initCoeditingOnWorker(e){const t=await this._imsServiceResolver();if(!t)return;const[r,i,o]=await Promise.all([this._loaderConfigResolver(),this._routeInfoResultResolver(),this._appConfigResolver()]);let s=r.apiKey;const{apiKeyLocal:a,disableAutoDocEngine:l}=r,h=i?.search?.get("disableAutoDocEngine");a&&(l||"true"===h)&&(s=a),t.isLoaded||await t.load();const u=await t.getAccessTokenValue();if(!u){(await this._loggerResolver()).debug("IMS token missing, will continue with Authoring initialization as guest user.")}const m=d.q.getLESAssetStatus.enabled;if(i?.action===c.k.new){const t={type:n.initCoediting,payload:{shouldPreconnect:!1,shouldPreconnectGetStatus:m,apiKey:s,authToken:u,lesEnvironment:r.lesEnv,sessionId:o.sessionId}};e.postMessage(t)}else if(i?.action===c.k.documentId){const t=i?.resourceId;if(!t)return;const a={type:n.initCoediting,payload:{shouldPreconnect:!0,shouldPreconnectGetStatus:m,docId:t,apiKey:s,authToken:u,lesEnvironment:r.lesEnv,sessionId:o.sessionId}};e.postMessage(a)}}async executeLoad(){return this._worker=this._workerFactory(),this._worker.addEventListener("message",this._handlePreloaderConfigRequest),this._worker.addEventListener("message",this._handleInitFontsOnWorker),this._worker}}const h="_hz_brick_manager";class u{constructor(e){this._storage=e}_parseStorage(){let e;return e=this._storage.getFromStorage(h),void 0===e&&(e={brickUrls:[]}),e}_saveStorage(e){this._storage.setInStorage(h,e)}addDynamicBrickUrl(e){const t=this._parseStorage();t.brickUrls.push(e),this._saveStorage(t)}reset(){this._storage.removeFromStorage(h)}get dynamicBrickUrls(){return this._parseStorage().brickUrls}}var m=r(543517),g=r(993308),p=r(790176),_=(e=>(e.exampleWorker="example-worker",e.psdParserWorker="psd-parser-worker",e.bitmapSelectionWasmWorker="bitmap-selection-wasm-worker",e.acrWasmWorker="acr-wasm-worker",e))(_||{}),f=(e=>(e.authoring="authoring",e.rendering="rendering",e.ui="ui",e))(f||{}),y=r(416048);const k=new Map([[_.psdParserWorker,()=>new Worker(new URL(r.p+r.u(89283),r.b),{type:void 0})],[_.bitmapSelectionWasmWorker,()=>new Worker(new URL(r.p+r.u(26071),r.b),{type:void 0})]]),b=new Map([[f.rendering,y.N.rendererHzWorkerInitCommunication]]);var v=r(789254),A=r(709640),w=r(341299),S=r(246060),R=r(587171),C=r(26505),F=r(372225),M=r(835244),D=r(835179),L=(e=>(e.hzWorkerInit="hzWorkerInit",e))(L||{});class T{constructor(e,t,r,i,o,n,s,a,c,d,l,h,u,m){this._authoringWorkerLoader=e,this._rendererWorkerLoader=t,this._uiSyncFrontend=r,this._logger=i,this._analyticsClient=o,this._appConfig=n,this.perf=s,this._messageChannelFrontend=a,this._buildInfo=c,this._canvasWebViewLoader=d,this._authoringConfig=l,this._resourceLoadConfig=h,this._browserService=u,this._intlStore=m,this._startAuthoringDeferred=new p.B,this._startAuthoringEngine=!0,this._rendererPortDeferred=new p.B,this._hzWorkers=new Map,this.createAndStartGenericWorker=e=>{const t=this._createGenericWorker(e.workerType);if(void 0===t)throw new Error(`Worker of type ${e.workerType} could not be created!`);this._startGenericWorker(t,e),this._uiSyncFrontend.submitAction({type:D.h.addNewHzWorker,payload:{workerId:e.workerType}})},this.terminateGenericWorker=e=>{if(e.workerType===f.rendering||e.workerType===f.authoring||e.workerType===f.ui)throw Error("Trying to terminate a primary worker. This is not yet allowed with the HzWorker infrastructure!");const t=this._hzWorkers.get(e.workerType);void 0!==t?(t.terminate(),this._uiSyncFrontend.submitAction({type:D.h.removeHzWorker,payload:{workerId:e.workerType}}),this._hzWorkers.delete(e.workerType),this._logger.debug(`HzWorker of type ${e.workerType} was terminated.`)):this._logger.warn(`Trying to terminate a HzWorker of type ${e.workerType} that does not exist!`)},this._handleAnalyticsContextUpdate=this._handleAnalyticsContextUpdate.bind(this),this._analyticsClient.context.addListener(this._handleAnalyticsContextUpdate)}async start(){const e=await this._canvasWebViewLoader();return this._rendererInfo=e.initializeWebView("renderer"),d.q.editorLoadOptimizations.enabled?(this._startAuthoringEngine&&this.startAuthoring(),await Promise.all([this._startRenderer(),this._startAuthoringDeferred.promise])):await Promise.all([this._startRenderer(),this.startAuthoring()]),this._rendererInfo.lowPerf}async destroyCanvas(){(await this._canvasWebViewLoader()).uninitializeWebView()}async rendererStartedPromise(){return await this._rendererPortDeferred.promise}reset(){this._startAuthoringEngine=!0,this._rendererPortDeferred.reset(),this._startAuthoringDeferred.reset()}async _startRenderer(){this.perf.beginStartupAction("renderer"),await this._createOrReuseRendererWorker();const e=await this._doStartRenderer(this._rendererWorker);this._rendererPortDeferred.resolve(e),this._logger.debug("Renderer started"),this.perf.endStartupAction("renderer")}async _renderInitParams(){const[e,t]=await Promise.all([this._appConfig.getWorkerDataTransfer(),this._getRendererConfig()]);return{appConfigData:e,config:t}}async _getRendererConfig(){const e=await this._appConfig.getSettings(),t={resourceLoadConfig:this._resourceLoadConfig,maxConcurrentDownloads:32,maxConcurrentDecodes:8,memoryStorageLimit:this._resourceCacheMemoryLimit,bitmapConfig:{thumbnailRenditionMaxDimension:d.q.thumbnailRenditionMaxDimension.value,previewRenditionMaxDimension:d.q.previewRenditionMaxDimension.value}},r=d.q.rendererAideEncoderEnabled.enabled,i=d.q.debugNativeRenderer.enabled,o=await this._canvasWebViewLoader();return{headless:Boolean(localStorage.e2e||e.isHeadless),syncConfig:A._,debugConfig:i?{socketUrl:"ws://127.0.0.1:7123/?origin=true"}:void 0,aideEncoderEnabled:r,canvasId:o.canvasId,resourceCacheConfig:t}}async startAuthoring(){if(this._startAuthoringEngine=!1,this.perf.beginStartupAction("authoring"),d.q.editorLoadOptimizations.enabled)try{await this._startAuthoringOnWorker(),this._startAuthoringDeferred.resolve()}catch(e){this._startAuthoringDeferred.reject(e)}else await this._startAuthoringOnWorker(),this._startAuthoringDeferred.resolve();this._logger.debug("Authoring started"),this.perf.endStartupAction("authoring"),this._localeChangeDisposer=(0,m.EH)((()=>{this._intlStore&&this._uiSyncFrontend.submitAction({type:M.S.changeLocale,payload:this._intlStore.locale})}))}async _doStartRenderer(e){const t=await this._renderInitParams(),r=[],i=(await this._canvasWebViewLoader()).transferOffscreenCanvas();i&&(t.offscreenCanvas=i,r.push(i));const o={type:w.z.rendererStart,payload:t};return new Promise((t=>{const i=setTimeout((()=>{this._logger.error("Renderer did not start in under 8000 (ms)")}),8e3);e.postMessage(o,r),e.addEventListener("message",(e=>{e.data.type===S.n.rendererStart&&(clearTimeout(i),t(e.data.payload.rendererPort))}))}))}_handleAnalyticsContextUpdate(e){if(!this._authoringWorker)return;const t={type:n.updateAnalyticsContext,payload:e};this._authoringWorker.postMessage(t,[])}_setMessageChannelBackendSyncCallback(e){this._messageChannelFrontend.setBackendSyncCallback(((t,r)=>{const i={type:n.syncMessageChannels,payload:t};e.postMessage(i,r)}))}async _createOrReuseAuthoringWorker(){this._logger.debug("Getting authoring worker...");const e=await this._authoringWorkerLoader();if(d.q.reuseAuthoringWorker.enabled&&this._authoringWorker)this._logger.debug("Reusing authoring worker...");else{if(this._logger.debug("Creating authoring worker..."),this._authoringWorker=await e.load(),!this._authoringWorker)throw new Error("Authoring worker was not loaded");this._hzWorkers.set(f.authoring,this._authoringWorker)}e.initCoeditingOnWorker(this._authoringWorker),this._setMessageChannelBackendSyncCallback(this._authoringWorker)}async _createOrReuseRendererWorker(){if(this._logger.debug("Getting renderer worker..."),!d.q.reuseRendererWorker.enabled||!this._rendererWorker){const e=await this._rendererWorkerLoader();if(this._rendererWorker=await e.load(),!this._rendererWorker)throw new Error("Renderer worker was not loaded");this._hzWorkers.set(f.rendering,this._rendererWorker)}}_userSetTraceflow(){let e;const t=this.getWindowLocationSearch(),r=new URLSearchParams(t);if(r.has("traceflow")){e={};r.getAll("traceflow").forEach((t=>{e[`traceflow-${t}`]=!0,e[`console-${t}`]=!0}))}return e}_shouldForceDebugUpgradeAndGC(){const e=this.getWindowLocationSearch();return new URLSearchParams(e).has("garbageCollection")}_schemaValidateOnOpen(){const e=this.getWindowLocationSearch(),t=new URLSearchParams(e).get("schemaValidate");return!("false"===t?.toLowerCase()||"0"===t)}getWindowLocationSearch(){return window.location.search}async _startAuthoringOnWorker(){if(!this._rendererPortDeferred)throw new Error(`${this.constructor.name}: failed to get renderer comm port!`);await this._createOrReuseAuthoringWorker();const e=await this._appConfig.getSettings(),t=await this._appConfig._getBrowserFlags(),r=this._userSetTraceflow();v.Yd.traceflowOverrides=r;const o=this._shouldForceDebugUpgradeAndGC(),s=this._schemaValidateOnOpen();this._handleAnalyticsContextUpdate(this._analyticsClient.context.generateInitPayload()),this._analyticsClient.setConsentListener((e=>{const t={type:n.updateAnalyticsClient,payload:e};this._authoringWorker?.postMessage(t,[])})),this._intlStore&&(this._authoringConfig.authoringLocale=this._intlStore.locale);const a={...this._authoringConfig,adobeIoApiKey:e.adobeIoApiKey??"",behanceApiHost:e.behanceApiHost??""};if(d.q.editorLoadOptimizations.enabled){const e={buildInfo:this._buildInfo,config:a,traceflowOverrides:v.Yd.traceflowOverrides,forceGC:o,schemaValidateOnOpen:s,browserFlags:t},r={type:n.startAuthoring,payload:e};this._authoringWorker.postMessage(r);const i=await this._rendererPortDeferred.promise,c={rendererConfig:await this._getRendererConfig(),rendererBackendPort:i},d={type:n.startAuthoringCore,payload:c};this._authoringWorker.postMessage(d,[i])}else{const[e,r]=await Promise.all([this._getRendererConfig(),this._rendererPortDeferred.promise]),i={buildInfo:this._buildInfo,config:a,rendererConfig:e,rendererBackendPort:r,traceflowOverrides:v.Yd.traceflowOverrides,forceGC:o,schemaValidateOnOpen:s,browserFlags:t},c={type:n.startAuthoring,payload:i};this._authoringWorker.postMessage(c,[r])}return new Promise((e=>{const t=setTimeout((()=>{this._logger.error("Authoring engine did not start in under 10000 (ms)")}),1e4);this._authoringWorker.addEventListener("message",(r=>{r.data.type===n.authoringStarted?(clearTimeout(t),e()):r.data.type===g.kC.PAYLOAD_FROM_WORKER&&i.R.defaultInstance.notifyListeners(r.data.payload)}))}))}get _resourceCacheMemoryLimit(){let e="low";const t=this._browserService.deviceMemoryCategory;return d.q.isHeadless.value?e="unlimited":"high"===t?e="high":"medium"===t&&(e="medium"),e}send(e){this._uiSyncFrontend.submitAction(e)}async newDocument(e){await this._startAuthoringDeferred.promise;const{type:t,docName:r,starterTemplateId:i,psdUrl:o,localDocId:n,parentAssetId:s,repositoryId:a,authToken:c,userId:d,queryParams:l,docConfigOptions:h,forceViewOnlyMode:u,dateTimeFormat:m,locale:g,sourceDocSpec:p,preloadedDocResponse:_,waitForFirstEdit:f,docModelIncompatibilityBehavior:y}=e,k=_&&{..._,errorData:_.error?.getDataRepresentation()};this.send({type:t,payload:{docName:r,starterTemplateId:i,psdUrl:o,localDocId:n,parentAssetId:s,repositoryId:a,authToken:c,userId:d,queryParams:l,docConfigOptions:h,forceViewOnlyMode:u,dateTimeFormat:m,locale:g,sourceDocSpec:p,preloadedDocResponse:k,waitForFirstEdit:f,docModelIncompatibilityBehavior:y}})}async triggerDocumentCreationIfNeeded(){await this._startAuthoringDeferred.promise,this.send({type:F.Q.createDocTrigger,payload:void 0})}async openDocument(e){await this._startAuthoringDeferred.promise;const{docId:t,repositoryId:r,authToken:i,userId:o,documentLoadHint:n,preloadedDocResponse:s,forceViewOnlyMode:a,forceReadOnlyMode:c,docStatePreference:d,docModelIncompatibilityBehavior:l}=e,h=s&&{...s,errorData:s.error?.getDataRepresentation()};this.send({type:F.Q.openDocument,payload:{docId:t,repositoryId:r,authToken:i,userId:o,documentLoadHint:n,forceViewOnlyMode:a,forceReadOnlyMode:c,preloadedDocResponse:h,docStatePreference:d,docModelIncompatibilityBehavior:l}})}initiateShutdownRendering(){this._rendererWorker.postMessage({type:R.X.rendererShutdown})}subscribeToRenderingShutdownCompleteNotification(e){const t=async r=>{r.data.type===C.b.rendererShutdown&&(this._rendererWorker?.removeEventListener("message",t),await e())};this._rendererWorker.addEventListener("message",t)}static _terminateWorker(e){e instanceof Worker?e.terminate():e instanceof MessagePort&&e.close()}async terminateAuthoringWorker(){T._terminateWorker(this._authoringWorker),this._localeChangeDisposer?.(),this._authoringWorker=void 0,this._logger.debug("Authoring terminated");(await this._authoringWorkerLoader()).reset(),this._hzWorkers.delete(f.authoring)}async terminateRenderingWorker(){T._terminateWorker(this._rendererWorker),this._rendererWorker=void 0,this._logger.debug("Renderer terminated");(await this._rendererWorkerLoader()).reset(),this._hzWorkers.delete(f.rendering)}async terminate(){await Promise.all([this.terminateAuthoringWorker(),this.terminateRenderingWorker()])}_createGenericWorker(e){const t=k.get(e);if(void 0===t)throw new Error(`${e}: is not a valid HzWorkerType!`);if(void 0!==this._hzWorkers.get(e))return void this._logger.warn(`A HzWorker of type ${e} already exists!`);const r=t();return this._hzWorkers.set(e,r),this._logger.debug(`HzWorker of type ${e} was created.`),r}_startGenericWorker(e,t){const r=[],i=[];t.communicationTargets.forEach((e=>{if(e.targetWorker===t.requestSourceWorkerType)return r.push({communicationDirection:e.communicationDirection,targetWorker:t.requestSourceWorkerType,messagePort:t.requestSourceWorkerPort}),void i.push(t.requestSourceWorkerPort);const o=this._hzWorkers.get(e.targetWorker);if(void 0===o)throw new Error(`Trying to establish communication with worker of type: ${e.targetWorker} which has not been started yet!`);const n=new MessageChannel;r.push({communicationDirection:e.communicationDirection,targetWorker:e.targetWorker,messagePort:n.port2}),i.push(n.port2);const s=b.get(e.targetWorker);if(void 0===s)throw new Error(`Notification for worker of type: ${e.targetWorker} is not defined!`);o.postMessage({type:s,payload:{targetWorker:t.workerType,messagePort:n.port1}},[n.port1])})),e.postMessage({type:L.hzWorkerInit,payload:{communicationPayload:r}},i),this._logger.debug(`HzWorker of type ${t.workerType} was started.`)}}async function I(e){const t=await e.get("AuthoringWorkerFactory"),r=e.getResolver("Logger"),i=e.getResolver("BasicRouteInfoResult"),o=e.getResolver("AppConfig"),n=e.getResolver("AuthoringWorkerLoaderOptions"),s=new l(r,t,i,(async()=>{if(await d.q.isHeadless.initialized(),await d.q.headlessOnlineSupport.initialized(),!d.q.isHeadless.value||d.q.headlessOnlineSupport.value)return await e.get("ImsService")}),o,n,(async()=>{if(await d.q.isHeadless.initialized(),!d.q.isHeadless.value)return await e.get("UserStore")}));return e.whenDefined("PerfMonitorModel",(async()=>{const t=await e.get("PerfMonitorModel");await s.setPerfMonitor(t)})),s}function E(e){e.set("AuthoringWorkerLoader",I)}async function P(e){const t=await e.get("AuthoringWorkerLoader");return await t.load()}function W(e){e.set("AuthoringWorker",P)}async function O(){return new o}function x(e){e.set("MessageChannelFrontend",O)}async function U(e){const t=await e.get("MessageChannelFrontend");return new s.mR(t)}function B(e){e.set("UISyncFrontend",U)}function N(e){e.set("AnalyticsClient",(async()=>i.R.defaultInstance))}async function q(e){const t=e.getResolver("AuthoringWorkerLoader"),r=e.getResolver("RendererWorkerLoader"),i=e.getResolver("CanvasWebView"),o=e.getAll(["MessageChannelFrontend","UISyncFrontend","Logger","AnalyticsClient","AppConfig","PerfMonitorModel"]),n=e.getAll(["BuildInfo","AuthoringEngineConfig","ResourceLoadConfig","BrowserService"]),[s,a]=await Promise.all([o,n]),[c,l,h,u,m,g]=s,[p,_,f,y]=a;await m.attach(d.q);let k;if(!d.q.isHeadless.value){let t;[t,k]=await e.getAll(["BrickManagerSettings","IntlStore"]),_.dynamicBrickUrls=t.dynamicBrickUrls}return new T(t,r,l,h,u,m,g,c,p,i,_,f,y,k)}function z(e){e.set("Workers",q)}async function H(e){const t=await e.get("SessionStorageService");return new u(t)}function V(e){e.set("BrickManagerSettings",H)}async function G(e){(await e.get("MessageChannelFrontend")).getFrontendPort("AudioRendererSyncChannel")}}}]);
//# sourceMappingURL=23553.c52869cbc574798070ca.js.map