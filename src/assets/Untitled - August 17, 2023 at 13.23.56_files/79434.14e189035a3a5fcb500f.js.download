"use strict";(this.webpackChunk_hz_project_x=this.webpackChunk_hz_project_x||[]).push([[79434],{610091:(e,t,i)=>{i.d(t,{R:()=>s});var o=i(907138);class s extends o.C{constructor(){super(...arguments),this.deleteKey=this.deleteInnerCollection}_makeInnerCollection(){return[]}_isCollectionEmpty(e){return 0===e.length}insert(e,t){this._store(e,(e=>e.push(t)))}insertUnique(e,t){return this._store(e,(e=>!e.includes(t)&&(e.push(t),!0)))}delete(e,t,i){return this._remove(e,(e=>{const o=i?e.findIndex((e=>i(e,t))):e.indexOf(t);return!(o<0)&&(e.splice(o,1),!0)}))}replace(e,t,i,o){return this._modify(e,(e=>{const s=o?e.findIndex((e=>o(e,t))):e.indexOf(t);return!(s<0)&&(e[s]=i,!0)}),!1)}get(e){return this.getInnerCollection(e)??[]}hasValue(e,t){return this._read(e,(e=>e.includes(t)),!1)}entries(){return this._outerMap.entries()}get keyCount(){return this.outerKeysCount()}getValueCount(){let e=0;for(const t of this._outerMap.values())e+=t.length;return e}}},907138:(e,t,i)=>{i.d(t,{C:()=>o});class o{constructor(){this._outerMap=new Map}_store(e,t){let i=this._outerMap.get(e);return i||(i=this._makeInnerCollection(),this._outerMap.set(e,i)),t(i)}_read(e,t,i){const o=this._outerMap.get(e);return o?t(o):i}_modify(e,t,i){const o=this._outerMap.get(e);return o?t(o):i}_remove(e,t){const i=this._outerMap.get(e);if(!i)return!1;const o=t(i);return this._isCollectionEmpty(i)&&this._outerMap.delete(e),o}deleteInnerCollection(e){return this._outerMap.delete(e)}clear(){this._outerMap.clear()}getInnerCollection(e){return this._outerMap.get(e)}outerKeysCount(){return this._outerMap.size}hasKey(e){return this._outerMap.has(e)}keys(){return this._outerMap.keys()}isEmpty(){return 0===this._outerMap.size}}},913596:(e,t,i)=>{var o;i.d(t,{h:()=>o}),function(e){e.viewModelUpdate="viewModelUpdate",e.notification="notification"}(o||(o={}))},379434:(e,t,i)=>{i.d(t,{MU:()=>d,mR:()=>l});var o=i(202625),s=i(610091),n=i(914083),r=i(913596),a=i(253624),c=i(502558),u=i(682248);const d=0;class h extends Error{constructor(e){super(`There is no subscription for view model type ${e}!`),this.viewModelType=e,this.name=this.constructor.name}}class l{constructor(e){this._portProvider=e,this._viewModels={},this._updateStrategies={[o.h.set]:new n.Zs,[o.h.merge]:new n.lw,[o.h.refresh]:new n.F$},this._viewModelSubscribers=new s.R,this._notificationSubscribers=new s.R,this._onMessageEvent=e=>{e.data.forEach((e=>{switch(e.type){case r.h.viewModelUpdate:this._onViewModelUpdate(e.payload);break;case r.h.notification:this._onViewNotification(e.payload);break;default:throw new a.R("Unreachable",`UISyncFrontEnd: Unknown message type ${e.type}`)}}))},this._setupPort()}reset(){this._port.removeEventListener("message",this._onMessageEvent),this._setupPort()}_setupPort(){this._port=this._portProvider.getFrontendPort("UISyncChannel"),this._port.addEventListener("message",this._onMessageEvent),this._port instanceof MessagePort&&this._port.start()}submitAction(e,t){t?this._port.postMessage(e,t):this._port.postMessage(e)}submitActionsWithTransaction(e,t,i,o,s){const n={type:u.a.compoundActionWithTransaction,payload:{messages:e,transactionInfo:{operationId:t,transactionOptions:i}},metadata:o};s?this._port.postMessage(n,s):this._port.postMessage(n)}submitActionsWithoutTransaction(e,t,i){const o={type:u.a.compoundActionWithoutTransaction,payload:{messages:e},metadata:t};i?this._port.postMessage(o,i):this._port.postMessage(o)}subscribeToViewModel(e,t){0===this._viewModelSubscribers.get(e).length&&(this._viewModels[e]={confirmedGeneration:d,unconfirmedGeneration:d});this._viewModelSubscribers.insertUnique(e,t)?this.submitAction({type:c.z.subscribe,payload:e}):console.warn(`${this.constructor.name}: Already subscribed to view model type ${e}!`)}unsubscribeFromViewModel(e,t){this._viewModelSubscribers.delete(e,t)?(0===this._viewModelSubscribers.get(e).length&&(this._viewModels[e]=void 0),this.submitAction({type:c.z.unsubscribe,payload:e})):console.warn(`${this.constructor.name}: Attempted to unsubscribe while it was not previously subscribed to view model type ${e}!`)}getViewModelSubscriberCount(e){return this._viewModelSubscribers.get(e).length}subscribeToNotifications(e,t){this._notificationSubscribers.insertUnique(e,t)}unsubscribeFromNotifications(e,t){this._notificationSubscribers.delete(e,t)}getNotificationSubscriberCount(e){return this._notificationSubscribers.get(e).length}notifyViewModelUpdate(e){const t=this._incrementViewModelGeneration(e);return this.submitAction({type:c.z.notifyUpdate,payload:{viewModelType:e,generation:t}}),t}getViewModel(e){return this._checkViewModelSubscription(e),this._viewModels[e]?.viewModel}getConfirmedViewModelGeneration(e){this._checkViewModelSubscription(e);const t=this._viewModels[e];return t?t.confirmedGeneration:d}getLatestViewModelGeneration(e){this._checkViewModelSubscription(e);const t=this._viewModels[e];return t?t.unconfirmedGeneration:d}triggerNotification(e){this._onViewNotification(e)}_incrementViewModelGeneration(e){this._checkViewModelSubscription(e);const t=this._viewModels[e];return t?++t.unconfirmedGeneration:d}_checkViewModelSubscription(e){if(!this._viewModelSubscribers.hasKey(e))throw new h(e)}_onViewModelUpdate(e){const{viewModelType:t,updates:i}=e,s=this._viewModels[t];if(!s)return;s.confirmedGeneration=e.generation,e.generation>s.unconfirmedGeneration&&(s.unconfirmedGeneration=e.generation);for(const e of i){if(void 0===s.viewModel&&e.type!==o.h.set)throw new Error(`Illegal state: expecting Authoring Engine to initially send a set update for a view model! viewModelType=${t}`);const i=this._updateStrategies[e.type];if(void 0===i)throw new Error(`Unimplemented view model update type ${e.type}!`);s.viewModel=i.applyViewModelUpdate(s.viewModel,e.payload)}const n=s.viewModel;if(n){this._viewModelSubscribers.get(t).forEach((o=>o(t,n,i,e.generation)))}}_onViewNotification(e){const t=this._notificationSubscribers.get(e.type);t&&t.forEach((t=>t(e)))}}},682248:(e,t,i)=>{var o,s;i.d(t,{a:()=>s,d:()=>o}),function(e){e.runLambda="runLambda"}(o||(o={})),function(e){e.compoundActionWithoutTransaction="compoundActionWithoutTransaction",e.compoundActionWithTransaction="compoundActionWithTransaction"}(s||(s={}))},502558:(e,t,i)=>{var o;i.d(t,{z:()=>o}),function(e){e.subscribe="subscribeToViewModel",e.unsubscribe="unsubscribeFromViewModel",e.notifyUpdate="notifyViewModelUpdate"}(o||(o={}))},202625:(e,t,i)=>{var o;i.d(t,{h:()=>o}),function(e){e.set="set",e.merge="merge",e.refresh="refresh"}(o||(o={}))},914083:(e,t,i)=>{i.d(t,{F$:()=>r,Zs:()=>s,lw:()=>n});var o=i(472326);class s{applyViewModelUpdate(e,t){return t}}class n{applyViewModelUpdate(e,t){if(void 0===e)throw new Error("View model is undefined; it was probably not set before merge!");const i=t,s=e;for(const e in i)o.i.isPropertyData(s[e])?Object.assign(s[e],i[e]):s[e]=i[e];return s}}class r{applyViewModelUpdate(e){if(void 0===e)throw new Error("View model is undefined; it was probably not set before merge!");return e}}}}]);
//# sourceMappingURL=79434.14e189035a3a5fcb500f.js.map