"use strict";(this.webpackChunk_hz_project_x=this.webpackChunk_hz_project_x||[]).push([[15027],{910048:(e,t,i)=>{i.d(t,{E$:()=>h});var s=i(193128),r=i(253624),n=i(790176),o=i(402820),a=i(866541);const c="anonymous_user_id";var d;!function(e){e.uninitialized="uninitialized",e.anonymous="anonymous",e.authenticated="authenticated",e.expired="expired"}(d||(d={}));class h{constructor(e,t,i,h={allowLoggedOutUser:!1,customSignInEnabled:!1},l=navigator){this._logger=e,this._sessionPersistenceService=t,this._imsServiceOptions=i,this.features=h,this._navigator=l,this._userState=d.uninitialized,this._tokenListeners=new Set,this._profileListeners=new Set,this._modalSignInDeferred=new n.B,this._modalSUSICallbackAttached=!1,this._locale="en_US",this._customSignInCallback=void 0,this._customSignInDeferred=void 0,this.processServiceWorkerMessage=async e=>{if("AUTHENTICATION_FAILURE"===e.data.msg){if(this.allowLoggedOutUser&&this.isAnonymousUser())return;let e=!1;try{e=await this._adobeIMS.validateToken()}finally{e||await this._signInInternal("token is not valid",{},!0)}}},this._modalSUSICallbackFunc=e=>{const t=this._modalSignInOptions?.redirect_uri,i=e.origin.includes("adobe.com")||e.origin===window.location.origin;e.data?.includes("wasmodal")&&i?(t&&this._reload(`${t}`),this._modalSignInDeferred.resolve()):this._modalSignInDeferred.reject("unable to sign in. Try again later."),window.removeEventListener("message",this._modalSUSICallbackFunc),this._modalSUSICallbackAttached=!1},this._onAccessToken=e=>{const t=this._userState===d.anonymous;this._userState=d.authenticated,e.token!==this._currentToken&&(this._currentToken=e.token,this._tokenListeners.forEach((t=>t(e.token))),this._scheduleTokenRefresh(e.expire?.getTime?.()-18e4-Date.now())),t&&(this._profilePromise=void 0,this.getProfile().then((()=>this._profileListeners.forEach((e=>e()))))),this._imsDeferred?.isSettled||this._imsDeferred?.resolve()},this._onReady=async()=>{(0,a.tz)(),this.isSignedInUser()||await this._onAccessTokenHasExpired(),this.allowLoggedOutUser||await this.ensureSignedInUser()},this._onAccessTokenHasExpired=async()=>{this._userState!==d.uninitialized&&this._userState!==d.authenticated||(this._userState=this._userState===d.uninitialized?d.anonymous:d.expired,this._userState===d.anonymous&&this.allowLoggedOutUser&&this._makeAnonymousProfile(),this._userState!==d.expired&&this.allowLoggedOutUser||await this._signInInternal("access token expired",{},!0),this._imsDeferred?.isSettled||this._imsDeferred?.resolve())},this._onError=(e,t)=>{throw this._imsDeferred?.reject(t),new r.R("ImsError",e,new Error(t))},this._generateAnonymousUserId=()=>`${(0,o.Z)()}@anonymous`,this._persistAnonymousProfile=(e,t)=>{window.sessionStorage.setItem(c,JSON.stringify({userId:e,name:t}))},this._retrieveAnonymousProfile=()=>{try{return JSON.parse(window.sessionStorage.getItem(c)??"")}catch(e){return}},this._makeAnonymousProfile=()=>{const e=this._retrieveAnonymousProfile(),{userId:t,name:i}=e??{userId:this._generateAnonymousUserId(),name:"Guest"};e||this._persistAnonymousProfile(t,i),this._profilePromise=Promise.resolve({account_type:"anonymous",countryCode:"UD",displayName:i,email:"",emailVerified:"false",first_name:i,last_name:"",mrktPerm:"",mrktPermEmail:"false",name:i,phoneNumber:"",preferred_languages:null,userId:t,utcOffset:""})};const{allowLoggedOutUser:_,customSignInEnabled:m}=h;this.allowLoggedOutUser=Boolean(_),this.customSignInEnabled=Boolean(m),this._adobeIMS=new s.H(this.adobeIdData);const{customSignInCallback:u}=this._imsServiceOptions;u&&this.registerCustomSignInCallback(u)}get locale(){return this._locale}set locale(e){this._locale=e}get adobeIMS(){return this._adobeIMS}get adobeIdData(){const e={client_id:this._imsServiceOptions.clientId,environment:this._imsServiceOptions.environment,scope:this._imsServiceOptions.scope,useLocalStorage:!1,autoValidateToken:!0,modalMode:this._isLoadedInIFrame(),modalSettings:{allowedOrigin:location.protocol+"//"+location.host},onReady:this._onReady,onError:this._onError,onAccessToken:this._onAccessToken,onAccessTokenHasExpired:this._onAccessTokenHasExpired};return this._addEmbedSpecificParams(e),e}get isLoaded(){return!0===this._imsDeferred?.isSettled}registerCustomSignInCallback(e){this.customSignInEnabled&&(this._customSignInCallback=e)}async load(){return this._imsDeferred||(this._imsDeferred=new n.B,await this.adobeIMS.initialize(),this.registerServiceWorkerMessage()),this._imsDeferred.promise}registerServiceWorkerMessage(){try{if(!("serviceWorker"in this._navigator))return;this._navigator.serviceWorker.removeEventListener("message",this.processServiceWorkerMessage),this._navigator.serviceWorker.addEventListener("message",this.processServiceWorkerMessage)}catch(e){this._logger.error(`Failed to add service worker message event listener ${e}`)}}isSignedInUser(){return this.adobeIMS.isSignedInUser()}isAnonymousUser(){return this._userState===d.anonymous}async getProfile(){return this.allowLoggedOutUser?await this.load():await this.ensureSignedInUser(),this._profilePromise||(this._profilePromise=this.adobeIMS.getProfile()),this._profilePromise}async getAccessTokenValue(){return this.isLoaded||await this.load(),this.adobeIMS.getAccessToken()?.token}addTokenListener(e){this._tokenListeners.add(e)}removeTokenListener(e){this._tokenListeners.delete(e)}addProfileListener(e){this._profileListeners.add(e)}removeProfileListener(e){this._profileListeners.delete(e)}async updateAnonymousProfile(e){const{userId:t}=this._retrieveAnonymousProfile();this._persistAnonymousProfile(t??this._generateAnonymousUserId(),e),this._makeAnonymousProfile(),this._profileListeners.forEach((e=>e()))}async ensureSignedInUser(){this.isLoaded||await this.load(),this.allowLoggedOutUser||this.isSignedInUser()||await this._signInInternal("user not signed in",{},!0)}async _signInCustom(e,t){if(!this.customSignInEnabled||!this._customSignInCallback)return this._signIn(e,t);if(this._customSignInDeferred)return this._customSignInDeferred.promise;this._customSignInDeferred=new n.B,this._logger.debug(`Will redirect to custom sign in screen. Reason: ${e}`),this._makeAnonymousProfile(),this._userState=d.anonymous,this._imsDeferred?.isSettled||this._imsDeferred?.resolve();try{await this._customSignInCallback(t),this._customSignInDeferred?.resolve(),this._customSignInDeferred=void 0}catch(i){return this._logger.debug(`Couldn't invoke custom sign in flow, falling back to IMS sign in: ${i}`),this._signIn(e,t)}}async _signInInternal(e,t,i=!1){if(this.customSignInEnabled&&i)return this._signInCustom(e,t);await this._signIn(e,t)}async _signIn(e,t){return this._logger?.debug(`Will redirect to IMS login. Reason: ${e}`),new Promise((()=>{this.adobeIMS.signIn({...t,locale:t?.locale||this._locale})}))}async _signUp(e,t){return this._logger?.debug(`Will redirect to IMS Sign Up. Reason: ${e}`),new Promise((()=>{this.adobeIMS.signUp({...t,locale:t?.locale||this._locale})}))}_inIframeSignIn(e,t){return this._logger?.debug(`Will launch pop window of IMS login. Reason: ${e}`),this._modalSignInOptions=t,this._modalSUSICallbackAttached||window.addEventListener("message",this._modalSUSICallbackFunc),this.adobeIMS.signIn({...t,locale:t?.locale||this._locale}),this._modalSignInDeferred.promise}_inIframeSignUp(e,t){return this._logger?.debug(`Will launch pop window of IMS SignUp. Reason: ${e}`),this._modalSignInOptions=t,this._modalSUSICallbackAttached||window.addEventListener("message",this._modalSUSICallbackFunc),this.adobeIMS.signUp({...t,locale:t?.locale||this._locale}),this._modalSignInDeferred.promise}_reload(e){window.location.assign(e)}signOut(e){this.adobeIMS.signOut(e)}getRedirectUrl(e){const t=e?new URL(e):new URL(window.location.href);return(0,a.F0)(this._sessionPersistenceService.getOtpToken(),t)}async _signInWithSocialProvider(e,t){return new Promise((()=>{this.adobeIMS.signInWithSocialProvider(e,{...t,locale:t?.locale||this._locale})}))}async signInWithSocialProvider(e,t){const i={redirect_uri:this.getRedirectUrl(t).href};await this._signInWithSocialProvider(e,i)}async customSignIn(e){await this.signIn(e,!0)}async signIn(e,t=!1,i={}){const s=this.getRedirectUrl(e),r="Manual trigger",n={...i,redirect_uri:s.href};if(this._isLoadedInIFrame())return s.searchParams.set("_cb",`${Date.now()}`),n.redirect_uri=s.href,void await this._inIframeSignIn(r,n);await this._signInInternal(r,n,t)}async signUp(){const e=this.getRedirectUrl(),t="Manual trigger",i={redirect_uri:e.href};if(this._isLoadedInIFrame())return e.searchParams.set("_cb",`${Date.now()}`),i.redirect_uri=e.href,void await this._inIframeSignUp(t,i);await this._signUp(t,i)}_getTopWindow(){return window.top}_getCurrentWindow(){return window.self}_isLoadedInIFrame(){return this._getTopWindow()!==this._getCurrentWindow()}async refreshToken(){return this._refreshTokenPromise||(this._refreshTokenPromise=new Promise((async e=>{try{await this.adobeIMS.refreshToken(),e("noError")}catch(t){this._logger.warn(`refreshToken failed with error "${t.error}"`),e(String(t.error))}this._refreshTokenPromise=void 0}))),this._refreshTokenPromise}_scheduleTokenRefresh(e){!e||e<0||(clearTimeout(this._tokenRefreshTimeout),this._tokenRefreshTimeout=setTimeout((()=>this.refreshToken()),e))}_addEmbedSpecificParams(e){const t=new URLSearchParams(window.location.search);t.get("embed")&&(t.get("userId")&&(e.api_parameters={...e.api_parameters,check_token:{user_id:t.get("userId")}}),e.analytics={appCode:"embed_"+t.get("ccEverywhereHostClientId")},e.redirect_uri=this.getRedirectUrl().toString(),e.overrideErrorHandler=e=>(this._logger?.debug(`Check token error in embed context. Error: ${e}`),!1))}}},866541:(e,t,i)=>{i.d(t,{F0:()=>a,Uz:()=>c,tz:()=>o});const s="hz_persistence",r="otp",n=/&?otp=(\d+)/,o=()=>{window.location.hash=window.location.hash.replace(n,"")},a=(e,t)=>{const i=t.hash?"&":"";return t.hash+=`${i}otp=${e}`,t};class c{constructor(){this._restoredData=this._restoreData(),this._storedData={},this.persist(r,Math.random().toFixed(10).substring(3))}getOtpToken(){return this._storedData[r]}getRestoredData(e){return this._restoredData[e]}persist(e,t){this._storedData[e]=t,window.sessionStorage.setItem(s,JSON.stringify(this._storedData))}remove(e){delete this._restoredData[e],delete this._storedData[e],window.sessionStorage.setItem(s,JSON.stringify(this._storedData))}_restoreData(){const e=this._getPersistedData();return e[r]!==(window.location.hash.match(n)?.[1]||"")?[]:e}_getPersistedData(){try{return JSON.parse(window.sessionStorage.getItem(s)??"{}")}catch(e){return{}}}}},847383:(e,t,i)=>{i.d(t,{H:()=>p});var s=i(5538),r=i(61658),n=i(449238),o=i(253624);class a{}a.CATEGORY_LOGGER_NAME="performance",a.ACTION_LOG_MESSAGE="perf action complete",a.ACTION_DESYNC_MESSAGE="clock-desync-perf-message",a.MAX_TIME_OFFSET_DIFFERENCE_THRESHOLD=10;class c{constructor(e,t,i,s){this._telemetryBrowser=i,this._nativeMobileBridge=s,this._histograms=new Map,this._mobileEnvironment=!1,this._requestEnvironment=async()=>(await this._nativeMobileBridge.pushPrimer.requestEnvironment()).data,this._recordLogs=(e,t)=>{const i={...this._getFrameStats("authoring",e),...this._getFrameStats("rendering",e),...this._getFrameStats("requestAnimationFrame",e),...this._getFrameStats("incrementalValidation",e)},s={};e.metadata&&Object.entries(e.metadata).forEach((([e,t])=>{null!=t&&(s[`custom.perf.${e}`]=t)}));const r={...t,...i,...s};this._isTimeOffsetValid(e)?this._categoryLogger.info(a.ACTION_LOG_MESSAGE,r):this._categoryLogger.info(a.ACTION_DESYNC_MESSAGE,r)},this._recordMetrics=e=>{if(!this._isTimeOffsetValid(e))return;const t=`hz_perfmonitor_${e.category}_${e.name}_duration_seconds`.replace(/-/g,"_");this._histograms.has(t)||this._histograms.set(t,this._meter.createHistogram(t));this._histograms.get(t).record((e.endTime-e.startTime)/1e3,{service_name:this._settings.serviceName})},this._isTimeOffsetValid=e=>Math.abs(e.startTimeOffset-e.endTimeOffset)<a.MAX_TIME_OFFSET_DIFFERENCE_THRESHOLD,this.recordCompletedAction=async e=>{if(e.hasBeenHidden&&"startup"===e.category)return;if(e.metadata&&!(0,r.hr)(Object.entries(e.metadata)))return;const t={"event.dts_start":new Date(e.startTime).toISOString(),"event.dts_end":new Date(e.endTime).toISOString(),"custom.perf_action_category":e.category,"custom.perf_action_name":e.name,"custom.perf_action_id":e.id,"custom.perf_action_duration":e.duration,"custom.perf_action_start_offset":e.startTimeOffset,"custom.perf_action_end_offset":e.endTimeOffset},i=t=>{this._recordLogs(e,t),this._recordMetrics(e)};if(!this._mobileEnvironment)return void i(t);if(await this._nativeMobileBridge.onAvailability)try{const e=await this._requestEnvironment();i({...t,"source.os_version":String(e["source.os_version"]),"source.device":String(e["hz.device_name"]),"source.platform":String(e["hz.source_platform_type"]),"custom.perf_action_total_ram":Number(e["hz.total_ram"]),"custom.perf_action_network_condition":String(e["hz.network_condition"]),"custom.perf_action_network_latency":Number(e["hz.network_latency"])})}catch(e){throw new o.R("NativeMobileBridgeFailure","Failed to requestEnvironment",{previousError:e,logMetadata:t})}else i(t)},this._settings=e,this._categoryLogger=t.get(a.CATEGORY_LOGGER_NAME),this._mobileEnvironment=this._nativeMobileBridge&&this._isMobileWebView(),this._meter=this._telemetryBrowser.meter("hz_perfmonitor")}_isMobileWebView(){return(0,n.BE)()}_getFrameStats(e,t){const i=t.getFramesByName(e);return i&&0!==i.framesCount?{[`custom.perf_action_num_frames_${e}`]:i.framesCount,[`custom.perf_action_min_frame_duration_${e}`]:i.minDuration,[`custom.perf_action_max_frame_duration_${e}`]:i.maxDuration,[`custom.perf_action_avg_frame_duration_${e}`]:i.avgDuration}:{[`custom.perf_action_num_frames_${e}`]:0,[`custom.perf_action_min_frame_duration_${e}`]:void 0,[`custom.perf_action_max_frame_duration_${e}`]:void 0,[`custom.perf_action_avg_frame_duration_${e}`]:void 0}}}async function d(e){const[t,i,s,r]=await e.getAll(["AppConfig","Logger","TelemetryBrowser","NativeMobileBridge"]),n=await t.getSettings();return new c(n,i,s,r)}class h{constructor(){this._perfActionCompletedProcessCallbacks=[],this._perfActionCompletedRecordCallbacks=[],this.handleCompletedAction=e=>{this._perfActionCompletedProcessCallbacks.forEach((t=>{t(e)})),this._perfActionCompletedRecordCallbacks.forEach((t=>{t(e)}))}}pushActionProcessCallback(e){this._perfActionCompletedProcessCallbacks.push(e)}pushActionRecordCallback(e){this._perfActionCompletedRecordCallbacks.push(e)}}async function l(){return new h}var _=i(505839),m=i(431947),u=i(605947);class g extends m.a{constructor(e,t){super(e,"load-renderer-worker"),this._configAttachPromise=t.attach(u.q)}async executeLoad(){await this._configAttachPromise;const e=u.q.isHeadless.value,t=u.q.playbackDecoderForVideoExport.enabled,s=u.q.enableHeadlessRendererNetwork.value;return!g._isOffscreenCanvasAvailable()||(!e||t)&&u.q.videoImportSupport.enabled||s?this._executeLoadOnUIThread():new Worker(new URL(i.p+i.u(8844),i.b),{type:void 0})}static _isOffscreenCanvasAvailable(){if(!("OffscreenCanvas"in globalThis))return!1;return!/^((?!chrome|chromium|android).)*safari/i.test(navigator.userAgent)}async _executeLoadOnUIThread(){const{loadRendererOnUIThread:e}=await Promise.all([i.e(6612),i.e(67523),i.e(36699),i.e(605),i.e(33340),i.e(10225),i.e(82375),i.e(17172),i.e(62544),i.e(46929),i.e(2340),i.e(382),i.e(98859)]).then(i.bind(i,803454));return e()}}async function f(e){const[t,i]=await e.getAll(["PerfMonitorModel","AppConfig"]);return new g(t,i)}async function S(e){const t=await e.get("RendererWorkerLoader");return await t.load()}async function p(e,t){(await e.get("AppConfig")).attach(u.q);const i=u.q.isHeadless.value,r=u.q.headlessOnlineSupport.value;(!i||i&&r)&&(0,s.Zy)(e),function(e){e.set("PerfMonitorLogger",d)}(e),function(e){e.set("PerfMonitorProcessor",l)}(e),t||((0,_.FU)(e),(0,s.gD)(e)),(0,s.dP)(e),function(e){e.set("RendererWorker",S)}(e),function(e){e.set("RendererWorkerLoader",f)}(e)}}}]);
//# sourceMappingURL=15027.c49de4080a702ffd042c.js.map